<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Custody Image Upload Wizard Form View -->
    <record id="custody_image_upload_wizard_form" model="ir.ui.view">
        <field name="name">custody.image.upload.wizard.form</field>
        <field name="model">custody.image.upload.wizard</field>
        <field name="arch" type="xml">
            <form string="üì∏ Upload Multiple Images">
                <header>
                    <button string="üöÄ Start Upload" 
                            name="action_upload_images" 
                            type="object" 
                            class="btn-primary"
                            invisible="upload_status != 'draft' or not can_upload"/>
                    
                    <button string="üîÑ Reset" 
                            name="action_reset_wizard" 
                            type="object" 
                            class="btn-secondary"
                            invisible="upload_status == 'uploading'"/>
                    
                    <button string="üëÅÔ∏è View Images" 
                            name="action_view_uploaded_images" 
                            type="object" 
                            class="btn-success"
                            invisible="upload_status != 'done'"/>
                    
                    <button string="‚ùå Close" 
                            name="action_close_wizard" 
                            type="object" 
                            class="btn-secondary"/>
                    
                    <field name="upload_status" widget="statusbar" statusbar_visible="draft,uploading,done"/>
                </header>

                <sheet>
                    <!-- Alert for upload restrictions -->
                    <div class="alert alert-warning" role="alert" invisible="can_upload">
                        <strong>‚ö†Ô∏è Upload Restricted</strong><br/>
                        <div invisible="image_type != 'before'">Before images can only be uploaded when custody is waiting for approval or later.</div>
                        <div invisible="image_type != 'after'">After images can only be uploaded when custody is approved or being returned.</div>
                        <div invisible="image_type != 'damage'">Damage images can only be uploaded when custody is approved or being returned.</div>
                    </div>

                    <!-- Progress Bar -->
                    <div class="alert alert-info" role="alert" invisible="upload_status != 'uploading'">
                        <div class="d-flex justify-content-between">
                            <span>üì§ Uploading images...</span>
                            <span><field name="progress_percentage"/>%</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                 role="progressbar" 
                                 style="width: 0%">
                            </div>
                        </div>
                    </div>

                    <!-- Success Message -->
                    <div class="alert alert-success" role="alert" invisible="upload_status != 'done'">
                        <strong>‚úÖ Upload Complete!</strong><br/>
                        All images have been successfully uploaded. You can now view them or close this wizard.
                    </div>

                    <!-- Error Message -->
                    <div class="alert alert-danger" role="alert" invisible="upload_status != 'error'">
                        <strong>‚ùå Upload Failed</strong><br/>
                        <field name="error_message" readonly="1"/>
                    </div>

                    <group>
                        <group string="üìã Upload Information">
                            <field name="custody_id" readonly="1"/>
                            <field name="employee_name" readonly="1"/>
                            <field name="property_name" readonly="1"/>
                            <field name="image_type" readonly="upload_status == 'uploading'"/>
                        </group>
                        <group string="üìä Upload Statistics">
                            <field name="total_files" readonly="1"/>
                            <field name="total_size_mb" readonly="1"/>
                            <field name="can_upload" invisible="1"/>
                        </group>
                    </group>

                    <!-- File Upload Zone -->
                    <group string="üìÅ File Selection" invisible="upload_status in ['uploading', 'done']">
                        <div class="o_form_field o_form_field_many2many_binary">
                            <!-- Custom File Upload Widget will be inserted here via JavaScript -->
                            <div id="custody_multiple_upload_zone" class="custody-upload-zone">
                                <div class="upload-dropzone">
                                    <div class="upload-content">
                                        <i class="fa fa-cloud-upload fa-3x text-muted mb-3"></i>
                                        <h4>Drop images here or click to browse</h4>
                                        <p class="text-muted">
                                            Supported formats: JPEG, PNG, GIF, WebP, BMP<br/>
                                            Max file size: 5MB per image<br/>
                                            Max total: 20 images, 100MB
                                        </p>
                                        <button type="button" class="btn btn-primary btn-lg" id="browse_files_btn">
                                            üìÇ Browse Files
                                        </button>
                                        <input type="file" 
                                               id="file_input" 
                                               multiple="multiple"
                                               accept="image/*" 
                                               style="display: none;"/>
                                    </div>
                                </div>
                                
                                <!-- Selected Files Preview -->
                                <div id="selected_files_preview" class="mt-3" style="display: none;">
                                    <h5>üìã Selected Files:</h5>
                                    <div id="files_list" class="row">
                                        <!-- Files will be listed here -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Hidden field to store file data -->
                        <field name="images_data" invisible="1"/>
                    </group>

                    <!-- Upload Configuration -->
                    <group string="‚öôÔ∏è Upload Configuration" invisible="upload_status in ['uploading', 'done']">
                        <group>
                            <field name="auto_sequence"/>
                            <field name="location_notes" placeholder="e.g., IT Room, Teacher Office"/>
                        </group>
                        <group>
                            <field name="bulk_description" placeholder="Optional description for all images"/>
                        </group>
                    </group>

                    <!-- Upload Instructions -->
                    <group string="üìñ Instructions" invisible="upload_status != 'draft'">
                        <div class="text-muted">
                            <p><strong>How to use this wizard:</strong></p>
                            <ol>
                                <li>Select the type of images you want to upload</li>
                                <li>Drop files into the upload zone or click "Browse Files"</li>
                                <li>Configure upload options (optional)</li>
                                <li>Click "Start Upload" to process all files</li>
                            </ol>
                            <p><strong>üìù Tips:</strong></p>
                            <ul>
                                <li>You can select multiple files at once using Ctrl+Click or Shift+Click</li>
                                <li>Drag and drop multiple files directly into the upload zone</li>
                                <li>Auto sequence will number your images automatically</li>
                                <li>Bulk description will be applied to all uploaded images</li>
                            </ul>
                        </div>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Custody Image Upload Wizard Action -->
    <record id="custody_image_upload_wizard_action" model="ir.actions.act_window">
        <field name="name">üì∏ Upload Multiple Images</field>
        <field name="res_model">custody.image.upload.wizard</field>
        <field name="view_mode">form</field>
        <field name="view_id" ref="custody_image_upload_wizard_form"/>
        <field name="target">new</field>
        <field name="context">{
            'default_custody_id': active_id,
            'default_image_type': 'before'
        }</field>
    </record>

    <!-- Before Images Upload Action -->
    <record id="custody_before_images_upload_action" model="ir.actions.act_window">
        <field name="name">üì∏ Upload Before Images</field>
        <field name="res_model">custody.image.upload.wizard</field>
        <field name="view_mode">form</field>
        <field name="view_id" ref="custody_image_upload_wizard_form"/>
        <field name="target">new</field>
        <field name="context">{
            'default_custody_id': active_id,
            'default_image_type': 'before'
        }</field>
    </record>

    <!-- After Images Upload Action -->
    <record id="custody_after_images_upload_action" model="ir.actions.act_window">
        <field name="name">üì∏ Upload After Images</field>
        <field name="res_model">custody.image.upload.wizard</field>
        <field name="view_mode">form</field>
        <field name="view_id" ref="custody_image_upload_wizard_form"/>
        <field name="target">new</field>
        <field name="context">{
            'default_custody_id': active_id,
            'default_image_type': 'after'
        }</field>
    </record>

    <!-- Damage Images Upload Action -->
    <record id="custody_damage_images_upload_action" model="ir.actions.act_window">
        <field name="name">üì∏ Upload Damage Images</field>
        <field name="res_model">custody.image.upload.wizard</field>
        <field name="view_mode">form</field>
        <field name="view_id" ref="custody_image_upload_wizard_form"/>
        <field name="target">new</field>
        <field name="context">{
            'default_custody_id': active_id,
            'default_image_type': 'damage'
        }</field>
    </record>
</odoo>
