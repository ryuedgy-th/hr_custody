<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Photo Testing Wizard Form View -->
    <record id="hr_custody_photo_tests_view_form" model="ir.ui.view">
        <field name="name">hr.custody.photo.tests.form</field>
        <field name="model">hr.custody.photo.tests</field>
        <field name="arch" type="xml">
            <form string="üì∏ Photo Management Testing">
                <header>
                    <button name="action_run_tests" string="üß™ Run Tests" type="object" class="btn-primary"/>
                    <button name="action_generate_test_photos" string="üéØ Generate Test Photos" type="object" class="btn-secondary"/>
                </header>
                
                <sheet>
                    <div class="oe_title">
                        <h1>üì∏ Photo Management Testing</h1>
                        <p>Comprehensive testing suite for photo upload, categorization, and quality assessment</p>
                    </div>
                    
                    <group>
                        <group name="test_config" string="Test Configuration">
                            <field name="custody_id" domain="[('state', 'in', ['draft', 'approved', 'returned'])]"/>
                            <field name="test_type" widget="radio"/>
                        </group>
                        
                        <group name="test_options" string="Test Options">
                            <field name="simulate_mobile"/>
                            <field name="test_large_files"/>
                            <field name="test_quality_variants"/>
                        </group>
                    </group>
                    
                    <group name="test_photos_group" string="üì∏ Test Photos">
                        <field name="test_photos" widget="many2many_binary" 
                               options="{'accepted_file_extensions': 'image/*'}"
                               nolabel="1"/>
                    </group>
                    
                    <!-- Test Guidelines -->
                    <div class="alert alert-info">
                        <strong>üìã Testing Guidelines:</strong><br/>
                        <ul>
                            <li><strong>Handover Upload:</strong> Tests basic photo upload and categorization</li>
                            <li><strong>Return Upload:</strong> Tests return photos and completion status</li>
                            <li><strong>Quality Assessment:</strong> Tests photo quality scoring system</li>
                            <li><strong>Photo Comparison:</strong> Tests handover vs return comparison</li>
                            <li><strong>Bulk Operations:</strong> Tests mass photo operations</li>
                            <li><strong>Mobile Simulation:</strong> Tests mobile-optimized workflow</li>
                            <li><strong>Performance Test:</strong> Tests system performance with photos</li>
                        </ul>
                    </div>
                    
                    <group name="test_results_group" string="üìä Test Results" invisible="not test_results">
                        <field name="test_results" nolabel="1" widget="html"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Photo Testing Results View - FIXED BUTTON NAMES -->
    <record id="hr_custody_photo_tests_results_view" model="ir.ui.view">
        <field name="name">hr.custody.photo.tests.results.form</field>
        <field name="model">hr.custody.photo.tests</field>
        <field name="arch" type="xml">
            <form string="üìä Photo Test Results">
                <header>
                    <button name="action_run_tests" string="üîÑ Run Again" type="object" class="btn-primary"/>
                    <!-- ‚úÖ FIXED: Removed problematic onclick button, replaced with proper action -->
                    <button name="action_copy_results" string="üìã View Results" type="object" class="btn-secondary"/>
                </header>
                
                <sheet>
                    <div class="oe_title">
                        <h1>üìä Test Results</h1>
                        <p>Photo management testing results for <field name="custody_id" readonly="1"/></p>
                    </div>
                    
                    <group>
                        <field name="test_results" nolabel="1" widget="html" readonly="1"/>
                    </group>
                    
                    <!-- Quick Actions -->
                    <div class="alert alert-success">
                        <strong>üéØ Next Steps:</strong><br/>
                        <ul>
                            <li>Review test results above</li>
                            <li>Fix any failed tests</li>
                            <li>Run performance tests with larger datasets</li>
                            <li>Test mobile workflow on actual devices</li>
                            <li>Validate photo quality with real photos</li>
                        </ul>
                    </div>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Photo Testing Action -->
    <record id="action_hr_custody_photo_tests" model="ir.actions.act_window">
        <field name="name">üì∏ Photo Testing</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">hr.custody.photo.tests</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{'default_test_type': 'upload_handover'}</field>
    </record>

    <!-- Add to Custody Form View - Testing Button -->
    <record id="hr_custody_form_view_photo_testing" model="ir.ui.view">
        <field name="name">hr.custody.form.photo.testing</field>
        <field name="model">hr.custody</field>
        <field name="inherit_id" ref="hr_custody.hr_custody_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//header" position="inside">
                <button name="%(hr_custody.action_hr_custody_photo_tests)d" 
                        string="üß™ Test Photos" 
                        type="action" 
                        class="btn-secondary"
                        groups="hr.group_hr_manager"
                        context="{'default_custody_id': active_id}"/>
            </xpath>
        </field>
    </record>

    <!-- Photo Performance Dashboard - SIMPLIFIED -->
    <record id="hr_custody_photo_performance_dashboard_view" model="ir.ui.view">
        <field name="name">hr.custody.photo.performance.dashboard</field>
        <field name="model">hr.custody.photo.tests</field>
        <field name="arch" type="xml">
            <form string="üìä Photo Performance Dashboard">
                <sheet>
                    <div class="oe_title">
                        <h1>üìä Photo System Performance</h1>
                        <p>Real-time monitoring of photo management system</p>
                    </div>
                    
                    <!-- Key Metrics Cards -->
                    <div class="row">
                        <div class="col-md-3">
                            <div class="alert alert-info text-center">
                                <h5>üì∏ Total Photos</h5>
                                <h2 class="text-primary">Loading...</h2>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="alert alert-success text-center">
                                <h5>‚≠ê Avg Quality</h5>
                                <h2 class="text-success">Loading...</h2>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="alert alert-warning text-center">
                                <h5>üíæ Storage Used</h5>
                                <h2 class="text-info">Loading...</h2>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="alert alert-primary text-center">
                                <h5>üìä Completion</h5>
                                <h2 class="text-warning">Loading...</h2>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Performance Tests -->
                    <group string="‚ö° Performance Tests">
                        <button name="action_run_tests" string="üß™ Run All Tests" type="object" 
                                class="btn-primary" context="{'test_type': 'performance_test'}"/>
                        <button name="action_run_tests" string="üì± Mobile Test" type="object" 
                                class="btn-secondary" context="{'test_type': 'mobile_simulation'}"/>
                        <button name="action_run_tests" string="üßô‚Äç‚ôÇÔ∏è Bulk Test" type="object" 
                                class="btn-secondary" context="{'test_type': 'bulk_operations'}"/>
                    </group>
                    
                    <!-- Recent Test Results -->
                    <group string="üìã Recent Test Results" invisible="not test_results">
                        <field name="test_results" nolabel="1" widget="html"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Photo Performance Dashboard Action -->
    <record id="action_hr_custody_photo_performance" model="ir.actions.act_window">
        <field name="name">üìä Photo Performance</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">hr.custody.photo.tests</field>
        <field name="view_mode">form</field>
        <field name="view_id" ref="hr_custody_photo_performance_dashboard_view"/>
        <field name="target">current</field>
    </record>

    <!-- Add to HR Custody Menu -->
    <menuitem id="menu_hr_custody_photo_performance"
              name="üìä Photo Performance"
              parent="hr_custody.menu_hr_custody_root"
              action="action_hr_custody_photo_performance"
              sequence="50"
              groups="hr.group_hr_manager"/>

</odoo>