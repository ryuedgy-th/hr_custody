<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- üìù Photo Notes Wizard -->
    <record id="custody_photo_notes_wizard_view_form" model="ir.ui.view">
        <field name="name">custody.photo.notes.wizard.form</field>
        <field name="model">custody.photo.notes.wizard</field>
        <field name="arch" type="xml">
            <form string="Add Photo Notes">
                <sheet>
                    <div class="oe_title">
                        <h1>üìù Add Photo Notes</h1>
                    </div>
                    
                    <group>
                        <group string="Photo Information">
                            <field name="attachment_name" readonly="1"/>
                            <field name="attachment_id" invisible="1"/>
                        </group>
                        <group string="Current Information">
                            <field name="current_notes" readonly="1" invisible="not current_notes"/>
                        </group>
                    </group>
                    
                    <group>
                        <group string="New Information">
                            <field name="notes" placeholder="Describe what this photo shows..." 
                                   widget="text" options="{'resizable': true}"/>
                            <field name="custody_location" placeholder="e.g. Office Room 101, Lab A, etc."/>
                        </group>
                    </group>
                </sheet>
                
                <footer>
                    <button string="üíæ Save Notes" name="action_save_notes" 
                            type="object" class="oe_highlight"/>
                    <button string="Cancel" class="btn-secondary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- üè∑Ô∏è Bulk Categorize Wizard -->
    <record id="custody_photo_bulk_categorize_wizard_view_form" model="ir.ui.view">
        <field name="name">custody.photo.bulk.categorize.wizard.form</field>
        <field name="model">custody.photo.bulk.categorize.wizard</field>
        <field name="arch" type="xml">
            <form string="Bulk Categorize Photos">
                <sheet>
                    <div class="oe_title">
                        <h1>üè∑Ô∏è Bulk Categorize Photos</h1>
                        <h2>
                            Selected <field name="photo_count" nolabel="1"/> photos for categorization
                        </h2>
                    </div>
                    
                    <div class="alert alert-info" role="alert">
                        <strong>üì∏ Bulk Photo Categorization:</strong><br/>
                        This will apply the selected category and optional notes/location to all selected photos.
                    </div>
                    
                    <group>
                        <group string="Categorization">
                            <field name="custody_photo_type" required="1"/>
                            <field name="add_notes"/>
                        </group>
                        <group string="Additional Information" invisible="not add_notes">
                            <field name="notes" placeholder="Add notes to all selected photos..." 
                                   widget="text" invisible="not add_notes"/>
                            <field name="location" placeholder="e.g. Main Office, Lab Room A" 
                                   invisible="not add_notes"/>
                        </group>
                    </group>
                    
                    <!-- Hidden field for selected photos -->
                    <field name="attachment_ids" invisible="1"/>
                </sheet>
                
                <footer>
                    <button string="üè∑Ô∏è Categorize Photos" name="action_categorize_photos" 
                            type="object" class="oe_highlight"/>
                    <button string="Cancel" class="btn-secondary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- üìä Quality Analysis Wizard - SIMPLIFIED VERSION -->
    <record id="custody_photo_quality_analysis_wizard_view_form" model="ir.ui.view">
        <field name="name">custody.photo.quality.analysis.wizard.form</field>
        <field name="model">custody.photo.quality.analysis.wizard</field>
        <field name="arch" type="xml">
            <form string="Photo Quality Analysis">
                <sheet>
                    <div class="oe_title">
                        <h1>üìä Photo Quality Analysis</h1>
                        <h2>Analyze photo documentation quality across custody records</h2>
                    </div>
                    
                    <!-- Filters Section -->
                    <group string="üìÖ Analysis Filters">
                        <group>
                            <field name="date_from"/>
                            <field name="date_to"/>
                        </group>
                        <group>
                            <field name="custody_ids" widget="many2many_tags"/>
                            <field name="employee_ids" widget="many2many_tags"/>
                            <field name="property_ids" widget="many2many_tags"/>
                        </group>
                    </group>
                    
                    <!-- Results Section -->
                    <group string="üìà Analysis Results" invisible="context.get('show_results', False) == False">
                        <group string="Photo Statistics">
                            <field name="total_photos" readonly="1"/>
                            <field name="high_quality_photos" readonly="1"/>
                            <field name="quality_percentage" readonly="1" widget="percentage"/>
                            <field name="avg_file_size" readonly="1"/>
                        </group>
                        <group string="Missing Documentation">
                            <field name="missing_handover_photos" readonly="1"/>
                            <field name="missing_return_photos" readonly="1"/>
                        </group>
                    </group>
                    
                    <!-- Simplified Quality Overview -->
                    <div invisible="context.get('show_results', False) == False" class="mt16">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="o_horizontal_separator">üìä Quality Overview</div>
                                <div class="mt8">
                                    <strong>Quality Score: </strong>
                                    <field name="quality_percentage" widget="percentage" nolabel="1"/>
                                </div>
                                <div class="mt4">
                                    <field name="high_quality_photos" nolabel="1"/> out of 
                                    <field name="total_photos" nolabel="1"/> photos are high quality
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="o_horizontal_separator">‚ö†Ô∏è Missing Documentation</div>
                                <div class="mt8">
                                    <div class="row">
                                        <div class="col-6">
                                            <div class="text-center">
                                                <div class="h3 text-warning">
                                                    <field name="missing_handover_photos" nolabel="1"/>
                                                </div>
                                                <small>Missing Handover</small>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="text-center">
                                                <div class="h3 text-danger">
                                                    <field name="missing_return_photos" nolabel="1"/>
                                                </div>
                                                <small>Missing Return</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </sheet>
                
                <footer>
                    <button string="üìä Analyze" name="action_generate_report" 
                            type="object" class="oe_highlight" 
                            invisible="context.get('show_results', False) == True"/>
                    <button string="üìÑ Export Missing Photos" name="action_export_missing_photos" 
                            type="object" class="btn-secondary"
                            invisible="context.get('show_results', False) == False"/>
                    <button string="Close" class="btn-secondary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- üì∏ Actions for Photo Management Wizards -->
    
    <!-- Photo Notes Wizard Action -->
    <record id="custody_photo_notes_wizard_action" model="ir.actions.act_window">
        <field name="name">üìù Add Photo Notes</field>
        <field name="res_model">custody.photo.notes.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{}</field>
    </record>

    <!-- Bulk Categorize Wizard Action -->
    <record id="custody_photo_bulk_categorize_wizard_action" model="ir.actions.act_window">
        <field name="name">üè∑Ô∏è Bulk Categorize Photos</field>
        <field name="res_model">custody.photo.bulk.categorize.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{}</field>
    </record>

    <!-- Quality Analysis Wizard Action -->
    <record id="custody_photo_quality_analysis_wizard_action" model="ir.actions.act_window">
        <field name="name">üìä Photo Quality Analysis</field>
        <field name="res_model">custody.photo.quality.analysis.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{}</field>
    </record>

    <!-- üìä Add Quality Analysis to Photo Gallery Menu -->
    <menuitem id="custody_photo_quality_analysis_menu"
              action="custody_photo_quality_analysis_wizard_action"
              parent="hr_custody_menu_management"
              name="üìä Photo Analytics"
              sequence="4"
              groups="hr.group_hr_manager"/>

    <!-- üì∏ Server Actions for Multi-select Operations -->
    
    <!-- Server Action: Add Notes to Selected Photos -->
    <record id="action_add_notes_to_photos" model="ir.actions.server">
        <field name="name">üìù Add Notes</field>
        <field name="model_id" ref="base.model_ir_attachment"/>
        <field name="binding_model_id" ref="base.model_ir_attachment"/>
        <field name="binding_view_types">list</field>
        <field name="state">code</field>
        <field name="code">
            # Filter only custody photos
            custody_photos = records.filtered(lambda r: r.res_model == 'hr.custody' and r.mimetype and r.mimetype.startswith('image/'))
            
            if not custody_photos:
                raise UserError("Please select custody photos only")
            
            if len(custody_photos) == 1:
                # Single photo - open notes wizard
                action = {
                    'type': 'ir.actions.act_window',
                    'name': 'Add Photo Notes',
                    'res_model': 'custody.photo.notes.wizard',
                    'view_mode': 'form',
                    'target': 'new',
                    'context': {
                        'default_attachment_id': custody_photos.id,
                        'default_notes': custody_photos.custody_notes or '',
                        'default_custody_location': custody_photos.custody_location or '',
                    }
                }
            else:
                # Multiple photos - open bulk categorize wizard
                action = {
                    'type': 'ir.actions.act_window',
                    'name': 'Bulk Categorize Photos',
                    'res_model': 'custody.photo.bulk.categorize.wizard',
                    'view_mode': 'form',
                    'target': 'new',
                    'context': {
                        'default_attachment_ids': [(6, 0, custody_photos.ids)],
                        'default_add_notes': True,
                    }
                }
        </field>
        <field name="groups_id" eval="[(4, ref('hr.group_hr_user'))]"/>
    </record>

    <!-- Server Action: Set Photo Type -->
    <record id="action_set_photo_type" model="ir.actions.server">
        <field name="name">üè∑Ô∏è Set Photo Type</field>
        <field name="model_id" ref="base.model_ir_attachment"/>
        <field name="binding_model_id" ref="base.model_ir_attachment"/>
        <field name="binding_view_types">list</field>
        <field name="state">code</field>
        <field name="code">
            # Filter only custody photos
            custody_photos = records.filtered(lambda r: r.res_model == 'hr.custody' and r.mimetype and r.mimetype.startswith('image/'))
            
            if not custody_photos:
                raise UserError("Please select custody photos only")
            
            # Open bulk categorize wizard
            action = {
                'type': 'ir.actions.act_window',
                'name': 'Bulk Categorize Photos',
                'res_model': 'custody.photo.bulk.categorize.wizard',
                'view_mode': 'form',
                'target': 'new',
                'context': {
                    'default_attachment_ids': [(6, 0, custody_photos.ids)],
                }
            }
        </field>
        <field name="groups_id" eval="[(4, ref('hr.group_hr_user'))]"/>
    </record>

</odoo>